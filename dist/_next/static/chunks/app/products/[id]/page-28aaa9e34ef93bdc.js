(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3403],{594:(e,r,t)=>{"use strict";t.d(r,{default:()=>R});var s=t(8081),a=t(2149),i=t(5186),n=t(7950),l=t.n(n),o=t(9651),c=t(5160),d=t(6810),u=t(4604),m=t(5977);let f=(0,t(1018).A)("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);var p=t(3261),x=t(6722),h=t(4690),v=t(3210),g=t(139);let y=0,N=new Map,j=e=>{if(N.has(e))return;let r=setTimeout(()=>{N.delete(e),T({type:"REMOVE_TOAST",toastId:e})},1e6);N.set(e,r)},b=(e,r)=>{switch(r.type){case"ADD_TOAST":return{...e,toasts:[r.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===r.toast.id?{...e,...r.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=r;return t?j(t):e.toasts.forEach(e=>{j(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===r.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==r.toastId)}}},w=[],S={toasts:[]};function T(e){S=b(S,e),w.forEach(e=>{e(S)})}function A(e){let{...r}=e,t=(y=(y+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>T({type:"DISMISS_TOAST",toastId:t});return T({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>T({type:"UPDATE_TOAST",toast:{...e,id:t}})}}var O=t(7126),C=t(2320);function R(e){let{product:r}=e,t=(0,o.useRouter)(),{toast:n}=function(){let[e,r]=a.useState(S);return a.useEffect(()=>(w.push(r),()=>{let e=w.indexOf(r);e>-1&&w.splice(e,1)}),[e]),{...e,toast:A,dismiss:e=>T({type:"DISMISS_TOAST",toastId:e})}}(),{isLoggedIn:y}=(0,O.A)(),{addItem:N}=(0,C._)(),[j,b]=(0,a.useState)(1),[R,k]=(0,a.useState)(0);return(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8",children:[(0,s.jsxs)("div",{className:"w-full lg:w-1/2",children:[(0,s.jsx)("div",{className:"relative aspect-square overflow-hidden rounded-lg mb-4",children:(0,s.jsx)(i.default,{src:r.images[R]||"/placeholder.svg",alt:r.name,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 50vw",priority:!0})}),(0,s.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2",children:r.images.map((e,t)=>(0,s.jsx)("button",{className:"relative w-20 h-20 rounded-md overflow-hidden border-2 ".concat(R===t?"border-emerald-600":"border-transparent"),onClick:()=>k(t),children:(0,s.jsx)(i.default,{src:e||"/placeholder.svg",alt:"".concat(r.name," ").concat(t+1),fill:!0,className:"object-cover",sizes:"80px"})},t))})]}),(0,s.jsxs)("div",{className:"w-full lg:w-1/2",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-2",children:r.name}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(f,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),(0,s.jsx)("span",{className:"ml-1 text-sm font-medium",children:r.rating})]}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"|"}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:[r.reviews," 条评价"]}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"|"}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["已售 ",r.sales," ",r.unit]})]}),(0,s.jsxs)("div",{className:"bg-muted/50 p-4 rounded-lg mb-6",children:[(0,s.jsxs)("div",{className:"flex items-baseline mb-2",children:[(0,s.jsxs)("span",{className:"text-3xl font-bold text-emerald-600",children:["\xa5",r.price]}),(0,s.jsxs)("span",{className:"ml-2 text-lg line-through text-muted-foreground",children:["\xa5",r.originalPrice]}),(0,s.jsx)(m.E,{className:"ml-2 bg-red-500",children:"限时优惠"})]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["单位: ",r.weight," | 起订量: ",r.minOrder," ",r.unit," | 库存: ",r.stock," ",r.unit]})]}),(0,s.jsxs)("div",{className:"border-t border-b py-4 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center mb-4",children:[(0,s.jsx)("span",{className:"w-20 text-sm text-muted-foreground",children:"配送"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(p.A,{className:"h-4 w-4 mr-1 text-emerald-600"}),(0,s.jsx)("span",{className:"text-sm",children:"支持全国配送 | 预计发货后 2-5 天送达 | 运费说明"})]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"w-20 text-sm text-muted-foreground",children:"服务"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(x.A,{className:"h-4 w-4 mr-1 text-emerald-600"}),(0,s.jsx)("span",{className:"text-sm",children:"品质保障"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(x.A,{className:"h-4 w-4 mr-1 text-emerald-600"}),(0,s.jsx)("span",{className:"text-sm",children:"准时送达"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(x.A,{className:"h-4 w-4 mr-1 text-emerald-600"}),(0,s.jsx)("span",{className:"text-sm",children:"售后无忧"})]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center mb-6",children:[(0,s.jsx)("span",{className:"w-20 text-sm text-muted-foreground",children:"数量"}),(0,s.jsxs)("div",{className:"flex items-center border rounded-md",children:[(0,s.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-none",onClick:()=>b(Math.max(r.minOrder,j-1)),disabled:j<=r.minOrder,children:(0,s.jsx)(h.A,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"w-12 text-center",children:j}),(0,s.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-none",onClick:()=>b(j+1),disabled:j>=r.stock,children:(0,s.jsx)(v.A,{className:"h-4 w-4"})})]})]}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)(c.$,{variant:"outline",size:"lg",className:"flex-1",onClick:()=>{if(!y){n({title:"请先登录",description:"您需要登录后才能将商品加入购物车",variant:"destructive"}),t.push("/login");return}N({id:r.id,name:r.name,price:r.price,image:r.images[0],quantity:j,unit:r.unit,minOrder:r.minOrder,supplier:r.supplier.name}),n({title:"已加入购物车",description:"".concat(r.name," x ").concat(j).concat(r.unit,"已成功加入购物车")})},children:[(0,s.jsx)(g.A,{className:"mr-2 h-5 w-5"}),"加入购物车"]}),(0,s.jsx)(c.$,{size:"lg",className:"flex-1 bg-emerald-600 hover:bg-emerald-700",onClick:()=>{if(!y){n({title:"请先登录",description:"您需要登录后才能购买商品",variant:"destructive"}),t.push("/login");return}N({id:r.id,name:r.name,price:r.price,image:r.images[0],quantity:j,unit:r.unit,minOrder:r.minOrder,supplier:r.supplier.name}),t.push("/cart")},children:"立即购买"})]}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(l(),{href:"/suppliers/".concat(encodeURIComponent(r.supplier.name)),className:"text-sm hover:text-emerald-600",children:r.supplier.name}),(0,s.jsx)(m.E,{variant:"outline",className:"text-xs",children:r.supplier.verificationLevel})]})})]})]}),(0,s.jsx)("div",{className:"mt-12",children:(0,s.jsxs)(u.Tabs,{defaultValue:"description",children:[(0,s.jsxs)(u.TabsList,{className:"w-full border-b rounded-none justify-start h-auto",children:[(0,s.jsx)(u.TabsTrigger,{value:"description",className:"text-lg py-3 px-6",children:"商品详情"}),(0,s.jsx)(u.TabsTrigger,{value:"specifications",className:"text-lg py-3 px-6",children:"规格参数"}),(0,s.jsxs)(u.TabsTrigger,{value:"reviews",className:"text-lg py-3 px-6",children:["商品评价(",r.reviews,")"]})]}),(0,s.jsx)(u.TabsContent,{value:"description",className:"py-6",children:(0,s.jsxs)("div",{className:"prose max-w-none",children:[(0,s.jsx)("p",{className:"text-lg mb-6",children:r.description}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,s.jsx)("div",{className:"aspect-video relative rounded-lg overflow-hidden",children:(0,s.jsx)(i.default,{src:"/premium-fruit-display.png",alt:"商品展示",fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 50vw"})}),(0,s.jsx)("div",{className:"aspect-video relative rounded-lg overflow-hidden",children:(0,s.jsx)(i.default,{src:"/fruit-quality-inspection.png",alt:"品质检测",fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 50vw"})})]})]})}),(0,s.jsx)(u.TabsContent,{value:"specifications",className:"py-6",children:(0,s.jsx)(d.Zp,{className:"border-none shadow-none",children:(0,s.jsx)("table",{className:"w-full",children:(0,s.jsx)("tbody",{children:r.specifications.map((e,r)=>(0,s.jsxs)("tr",{className:r%2==0?"bg-muted/50":"",children:[(0,s.jsx)("td",{className:"py-3 px-4 w-1/4 font-medium",children:e.name}),(0,s.jsx)("td",{className:"py-3 px-4",children:e.value})]},r))})})})}),(0,s.jsx)(u.TabsContent,{value:"reviews",className:"py-6",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"商品评价"}),(0,s.jsx)(c.$,{variant:"outline",children:"写评价"})]}),(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"暂无评价，购买后可以发表评价"})})]})})]})})]})}},1018:(e,r,t)=>{"use strict";t.d(r,{A:()=>o});var s=t(2149);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,s.forwardRef)((e,r)=>{let{color:t="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...m}=e;return(0,s.createElement)("svg",{ref:r,...n,width:a,height:a,stroke:t,strokeWidth:o?24*Number(l)/Number(a):l,className:i("lucide",c),...m},[...u.map(e=>{let[r,t]=e;return(0,s.createElement)(r,t)}),...Array.isArray(d)?d:[d]])}),o=(e,r)=>{let t=(0,s.forwardRef)((t,n)=>{let{className:o,...c}=t;return(0,s.createElement)(l,{ref:n,iconNode:r,className:i("lucide-".concat(a(e)),o),...c})});return t.displayName="".concat(e),t}},2320:(e,r,t)=>{"use strict";t.d(r,{CartProvider:()=>l,_:()=>o});var s=t(8081),a=t(2149),i=t(7126);let n=(0,a.createContext)(void 0);function l(e){let{children:r}=e,[t,l]=(0,a.useState)([]),{isLoggedIn:o}=(0,i.A)();(0,a.useEffect)(()=>{if(o){let e=localStorage.getItem("cart");if(e)try{l(JSON.parse(e))}catch(e){console.error("Failed to parse stored cart",e),localStorage.removeItem("cart")}}else l([])},[o]),(0,a.useEffect)(()=>{o&&t.length>0&&localStorage.setItem("cart",JSON.stringify(t))},[t,o]);let c=t.reduce((e,r)=>e+r.quantity,0),d=t.reduce((e,r)=>e+r.price*r.quantity,0);return(0,s.jsx)(n.Provider,{value:{items:t,addItem:e=>{l(r=>r.find(r=>r.id===e.id)?r.map(r=>r.id===e.id?{...r,quantity:r.quantity+e.quantity}:r):[...r,e])},removeItem:e=>{l(r=>r.filter(r=>r.id!==e))},updateQuantity:(e,r)=>{l(t=>t.map(t=>t.id===e?{...t,quantity:r}:t))},clearCart:()=>{l([]),localStorage.removeItem("cart")},totalItems:c,totalPrice:d},children:r})}function o(){let e=(0,a.useContext)(n);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},2945:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),!function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{default:function(){return o},getImageProps:function(){return l}});let s=t(4879),a=t(4535),i=t(2611),n=s._(t(149));function l(e){let{props:r}=(0,a.getImgProps)(e,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,t]of Object.entries(r))void 0===t&&delete r[e];return{props:r}}let o=i.Image},3210:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(1018).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},3261:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(1018).A)("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]])},3484:(e,r,t)=>{"use strict";t.d(r,{F:()=>n});var s=t(6522);let a=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,i=s.$,n=(e,r)=>t=>{var s;if((null==r?void 0:r.variants)==null)return i(e,null==t?void 0:t.class,null==t?void 0:t.className);let{variants:n,defaultVariants:l}=r,o=Object.keys(n).map(e=>{let r=null==t?void 0:t[e],s=null==l?void 0:l[e];if(null===r)return null;let i=a(r)||a(s);return n[e][i]}),c=t&&Object.entries(t).reduce((e,r)=>{let[t,s]=r;return void 0===s||(e[t]=s),e},{});return i(e,o,null==r?void 0:null===(s=r.compoundVariants)||void 0===s?void 0:s.reduce((e,r)=>{let{class:t,className:s,...a}=r;return Object.entries(a).every(e=>{let[r,t]=e;return Array.isArray(t)?t.includes({...l,...c}[r]):({...l,...c})[r]===t})?[...e,t,s]:e},[]),null==t?void 0:t.class,null==t?void 0:t.className)}},3799:(e,r,t)=>{Promise.resolve().then(t.bind(t,594))},4604:(e,r,t)=>{"use strict";t.d(r,{Tabs:()=>l,TabsContent:()=>d,TabsList:()=>o,TabsTrigger:()=>c});var s=t(8081),a=t(2149),i=t(2321),n=t(7687);let l=i.bL,o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(i.B8,{ref:r,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...a})});o.displayName=i.B8.displayName;let c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(i.l9,{ref:r,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...a})});c.displayName=i.l9.displayName;let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(i.UC,{ref:r,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...a})});d.displayName=i.UC.displayName},4690:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(1018).A)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},5160:(e,r,t)=>{"use strict";t.d(r,{$:()=>c});var s=t(8081),a=t(2149),i=t(4743),n=t(3484),l=t(7687);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,r)=>{let{className:t,variant:a,size:n,asChild:c=!1,...d}=e,u=c?i.DX:"button";return(0,s.jsx)(u,{className:(0,l.cn)(o({variant:a,size:n,className:t})),ref:r,...d})});c.displayName="Button"},5186:(e,r,t)=>{"use strict";t.d(r,{default:()=>a.a});var s=t(2945),a=t.n(s)},5977:(e,r,t)=>{"use strict";t.d(r,{E:()=>l});var s=t(8081);t(2149);var a=t(3484),i=t(7687);let n=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:r,variant:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)(n({variant:t}),r),...a})}},6722:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(1018).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},6810:(e,r,t)=>{"use strict";t.d(r,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>n,aR:()=>l,wL:()=>u});var s=t(8081),a=t(2149),i=t(7687);let n=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});n.displayName="Card";let l=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...a})});l.displayName="CardHeader";let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",t),...a})});o.displayName="CardTitle";let c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",t),...a})});d.displayName="CardContent";let u=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",t),...a})});u.displayName="CardFooter"},7126:(e,r,t)=>{"use strict";t.d(r,{A:()=>c,AuthProvider:()=>o});var s=t(8081),a=t(2149),i=t(9651),n=t(3852);let l=(0,a.createContext)(void 0);function o(e){let{children:r}=e,[t,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0),u=(0,i.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("user");if(e)try{o(JSON.parse(e))}catch(e){console.error("Failed to parse stored user",e),localStorage.removeItem("user")}d(!1)},[]);let m=async e=>{try{let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await r.json();return t.success&&t.user?(o(t.user),localStorage.setItem("user",JSON.stringify(t.user)),n.oR.success("登录成功"),u.push("/")):n.oR.error(t.error||"登录失败"),t}catch(e){return console.error("Login error:",e),n.oR.error("登录失败，请稍后重试"),{success:!1,error:"登录失败，请稍后重试"}}},f=async e=>{try{let r=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await r.json();return t.success?(n.oR.success("注册成功，请登录"),u.push("/login")):n.oR.error(t.error||"注册失败"),t}catch(e){return console.error("Register error:",e),n.oR.error("注册失败，请稍后重试"),{success:!1,error:"注册失败，请稍后重试"}}},p=async()=>{try{let e=await fetch("/api/auth/logout",{method:"POST"}),r=await e.json();r.success?(o(null),localStorage.removeItem("user"),localStorage.removeItem("cart"),n.oR.success("已退出登录"),u.push("/login")):n.oR.error(r.error||"退出失败")}catch(e){console.error("Logout error:",e),n.oR.error("退出失败，请稍后重试")}},x=async e=>{try{let r=await fetch("/api/auth/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await r.json();if(t.success&&t.user)return o(t.user),localStorage.setItem("user",JSON.stringify(t.user)),n.oR.success("个人信息更新成功"),!0;return n.oR.error(t.error||"更新失败"),!1}catch(e){return console.error("Update user error:",e),n.oR.error("更新失败，请稍后重试"),!1}},h=async e=>{try{let r=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),t=await r.json();if(t.success)return n.oR.success("重置密码邮件已发送，请查收"),!0;return n.oR.error(t.error||"发送重置密码邮件失败"),!1}catch(e){return console.error("Reset password error:",e),n.oR.error("发送重置密码邮件失败，请稍后重试"),!1}},v=async(e,r)=>{try{let t=await fetch("/api/auth/confirm-reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,newPassword:r})}),s=await t.json();if(s.success)return n.oR.success("密码重置成功，请重新登录"),u.push("/login"),!0;return n.oR.error(s.error||"密码重置失败"),!1}catch(e){return console.error("Confirm reset password error:",e),n.oR.error("密码重置失败，请稍后重试"),!1}};return(0,s.jsx)(l.Provider,{value:{user:t,isLoading:c,login:m,register:f,logout:p,isLoggedIn:!!t,updateUser:x,resetPassword:h,confirmPasswordReset:v},children:r})}function c(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7687:(e,r,t)=>{"use strict";t.d(r,{cn:()=>i});var s=t(6522),a=t(4483);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.QP)((0,s.$)(r))}}},e=>{var r=r=>e(e.s=r);e.O(0,[8114,2611,7950,2321,4708,497,954,7358],()=>r(3799)),_N_E=e.O()}]);